{% extends 'package/base_form_page.html' %}

{% set pkg = c.pkg_dict %}

{% block breadcrumb_content_selected %}{% endblock %}

{% block breadcrumb_content %}
  {{ super() }}
  <li class="active">{% link_for _('Edit'), controller='package', action='edit', id=pkg.name %}</li>
{% endblock %}

{% block primary_content %}
  <header class="module-content page-header"></header>
    <div class="wet-boew-tabbedinterface tabs-style-3 auto-height-none">
      <ul class="tabs">
        <li><a href="#tabs_update">{{ _("Update") }}</a></li>
        {% if pkg.resources and h.check_access('package_update', {'id': pkg.id }) %}
          <li><a href="#tabs_delete">{{ _("Delete") }}</a></li>
        {% endif %}
        <li class="default"><a href="#tabs_api">{{ _("API Access") }}</a></li>
      </ul>
      <div class="tabs-panel" style="padding: 1px 10px">
        <div id="tabs_update"> {#{% if not delete_errors %}open{% endif %}#}
          <div class="module-content">
            {% if h.check_access('package_update', {'id': pkg.id }) %}
              {% snippet "recombinant/snippets/xls_upload.html",
                pkg=pkg, errors=errors %}
            {% else %}
              {% snippet "recombinant/snippets/xls_download.html",
                pkg=pkg, errors=errors %}
            {% endif %}
          </div>
        </div>
        {% if pkg.resources %}
          {% if h.check_access('package_update', {'id': pkg.id }) %}
            <div id="tabs_delete">
              {% snippet "recombinant/snippets/delete.html",
                pkg=pkg, errors=delete_errors, filters=filters %}
            </div>
          {% endif %}
          {% set resource_id = pkg.resources[0].id %}
          {% set profile_url = h.url_for(controller='user', action='read', id=c.userobj.name) %}
          <div id="tabs_api">
            <h4>{{ _("Resource ID") }}</h4>
            <p>{% trans %}Access this data through the
              <a href="http://docs.ckan.org/en/latest/maintaining/datastore.html#the-datastore-api"
              >CKAN Datastore API</a>
              with <code>resource_id="{{ resource_id }}"</code>{% endtrans %}
            </p>
            <p>{% trans %}The CKAN API uses a JSON-RPC style, where you post a JSON object and receive another
            JSON object in response.{% endtrans %}</p>
            <h5>{{ _("Example:") }}</h4>
            <h6>curl</h4>
            <pre><code class="bash"
>curl {{ g.site_url }}/api/action/datastore_search -d '{"resource_id":"{{ resource_id }}"}'</code></pre>
            <h6>Python</h4>
            <pre><code class="python"
>import ckanapi
from pprint import pprint
ckan = ckanapi.RemoteCKAN('{{ g.site_url }}')
result = ckan.action.datastore_search(resource_id="{{ resource_id }}")
pprint(result['records'])</code></pre>
            <h4>{{ _("Your API Key") }}</h4>
            <p>{% trans %}Updating records requires an API key. Your API key is shown on your
            <a href="{{ profile_url }}">profile page</a>. Please do not include
            your API key in any code shared with other people. Use a configuration file or environment
            variable to let each user input their own key when they use your tool.{% endtrans %}</p>
            <p>{% trans %}Your API key is <em>equivalent to your password</em> and may be used to
            perform any action your user can on this site. All actions made with your API key will be
            logged as actions you performed.{% endtrans %}</p>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock %}

{% block links %}
{{ super() }}
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/styles/docco.min.css">
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.0.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
{% endblock %}

